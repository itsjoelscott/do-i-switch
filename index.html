<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Do I Switch?</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9644805660093707" crossorigin="anonymous"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f5f7fa;
      color: #1f2937;
      line-height: 1.4;
    }
    .container {
      width: 100%;
      max-width: 1100px;
      margin: auto;
      padding: 1rem 0;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 0.2rem;
      text-align: center;
    }
    .subheader {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #555;
      text-align: center;
    }
    .controls {
      display: flex;
      position: relative;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }
    .last-updated {
      position: absolute;
      left: 0;
      font-size: 0.85rem;
      color: #555;
    }
    .controls input,
    .controls select {
      padding: 0.4rem;
      font-size: 0.85rem;
      border: 1px solid #cbd5e1;
      border-radius: 4px;
    }
    .table-wrapper {
      margin-top: 1rem;
      overflow-x: auto;
    }
    table {
      width: 100%;
      table-layout: auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    thead {
      background: #1f4e79;
      color: #fff;
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #e2e8f0;
      vertical-align: top;
      font-size: 0.85rem;
      text-align: left;
      word-break: break-word;
    }
    /* Center iOS and Android columns */
    td[data-label="iOS"],
    td[data-label="Android"],
    th[data-label="iOS"],
    th[data-label="Android"] {
      text-align: center;
      min-width: 4rem;
      padding-left: 1rem;
      padding-right: 1rem;
    }
    /* Hide the '#' column */
    th[data-label="#"],
    td[data-label="#"] {
      display: none;
    }
    th { position: sticky; top: 0; }
    tr:nth-child(even) { background: #f9f9fb; }

    /* Toggle cell hidden on desktop */
    .toggle-cell { display: none; }

    /* Mobile-specific styles */
    @media (max-width: 900px) {
      /* Hide Explanation column in main row */
      th[data-label="Explanation"],
      td[data-label="Explanation"] {
        display: none;
      }
      /* Show toggle cell */
      #comparison-table .toggle-cell {
        display: table-cell !important;
        width: 1.2rem;
      }
      #comparison-table .toggle-cell .exp-toggle {
        background: none;
        border: none;
        font-size: 1rem;
        cursor: pointer;
        padding: 0;
        margin: 0;
        line-height: 1;
      }
      /* Smaller text and padding */
      th, td {
        padding: 0.4rem;
        font-size: 0.75rem;
      }
      /* Auto-size key columns but not shrink below header width */
      th[data-label="Category"], td[data-label="Category"],
      th[data-label="iOS"], td[data-label="iOS"],
      th[data-label="Android"], td[data-label="Android"] {
        width: auto;
        min-width: max-content;
        white-space: nowrap;
      }
      /* Hide explanation rows by default */
      .exp-row {
        display: none;
      }
    }
    /* Ensure all explanation rows are hidden by default */
    .exp-row {
      display: none;
    }
    /* Style for explanation content */
    .exp-cell {
      padding: 0.75rem;
      border: 1px solid #e2e8f0;
      font-size: 0.85rem;
      word-break: break-word;
      overflow-wrap: break-word;
      box-sizing: border-box;
    }
    .small { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Do I Switch?</h1>
    <p class="subheader">
      Switching between iphone and android can be a stressful decision. Here we broke it down by category with explanations for each area that you should keep in mind when considering a switch!
    </p>
    <div class="controls">
      <span id="last-updated" class="last-updated">Last Updated:</span>
      <label>Category:
        <select id="category-filter"><option value="">All Categories</option></select>
      </label>
      <label>Search:
        <input type="text" id="search-box" placeholder="Search..." />
      </label>
    </div>
    <div class="status" id="status">Loading comparison table…</div>
    <div class="table-wrapper">
      <table id="comparison-table" aria-label="iOS vs Android comparison" hidden>
        <thead id="table-head"></thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
  </div>
  <script>
    let allRows = [];
    async function fetchAndRender() {
      const statusEl = document.getElementById('status');
      const lastUpdatedEl = document.getElementById('last-updated');
      const rawUrl = 'https://raw.githubusercontent.com/itsjoelscott/do-i-switch/1296845b511408abc7c76d6bc564f2e0db90577d/comparison.csv';
      try {
        const res = await fetch(rawUrl);
        if (!res.ok) throw new Error(res.statusText);
        const lastMod = res.headers.get('last-modified');
        if (lastMod) {
          lastUpdatedEl.textContent = 'Last Updated: ' + new Date(lastMod).toLocaleDateString();
        }
        const text = await res.text();
        const rows = parseCSV(text);
        if (!rows.length) {
          statusEl.textContent = 'CSV is empty or malformed.';
          return;
        }
        allRows = rows;
        buildTable(rows);
        populateCategoryFilter(rows);
        statusEl.textContent = '';
      } catch (e) {
        statusEl.textContent = 'Error loading table: ' + e.message;
        console.error(e);
      }
    }
    function parseCSV(text) {
      const rows = [];
      let i = 0,
        len = text.length,
        cur = '',
        row = [],
        inQ = false;
      while (i < len) {
        const ch = text[i];
        if (inQ) {
          if (ch === '"') {
            if (i + 1 < len && text[i + 1] === '"') {
              cur += '"';
              i += 2;
              continue;
            }
            inQ = false;
            i++;
          } else {
            cur += ch;
            i++;
          }
        } else {
          if (ch === '"') {
            inQ = true;
            i++;
          } else if (ch === ',') {
            row.push(cur);
            cur = '';
            i++;
          } else if (ch === '\r') {
            i++;
          } else if (ch === '\n') {
            row.push(cur);
            rows.push(row);
            row = [];
            cur = '';
            i++;
          } else {
            cur += ch;
            i++;
          }
        }
      }
      if (cur !== '' || text.endsWith(',')) row.push(cur);
      if (row.length) rows.push(row);
      return rows;
    }
    function buildTable(rows) {
      const thead = document.getElementById('table-head'), tbody = document.getElementById('table-body');
      thead.innerHTML = '';
      tbody.innerHTML = '';
      const headers = rows[0],
        expIdx = headers.indexOf('Explanation');
      const hr = document.createElement('tr');
      const thToggle = document.createElement('th');
      thToggle.className = 'toggle-cell';
      hr.appendChild(thToggle);
      headers.forEach(h => {
        const th = document.createElement('th');
        const label = h === 'iPhone' ? 'iOS' : h;
        th.textContent = label;
        th.setAttribute('data-label', label);
        hr.appendChild(th);
      });
      thead.appendChild(hr);
      rows.slice(1).forEach(row => {
        const tr = document.createElement('tr');
        const tc = document.createElement('td');
        tc.className = 'toggle-cell';
        const btn = document.createElement('button');
        btn.className = 'exp-toggle';
        btn.textContent = '▶';
        tc.appendChild(btn);
        tr.appendChild(tc);
        row.forEach((c, i) => {
          const td = document.createElement('td');
          const header = headers[i] === 'iPhone' ? 'iOS' : headers[i];
          td.setAttribute('data-label', header);
          td.textContent = c;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
        const er = document.createElement('tr');
        er.className = 'exp-row';
        const ec = document.createElement('td');
        ec.className = 'exp-cell';
        ec.colSpan = headers.length + 1;
        ec.textContent = row[expIdx] || '';
        er.appendChild(ec);
        tbody.appendChild(er);
      });
      document.getElementById('comparison-table').hidden = false;
    }
    function populateCategoryFilter(rows) {
      const sel = document.getElementById('category-filter'),
        idx = rows[0].indexOf('Category');
      if (idx < 0) return;
      new Set(rows.slice(1).map(r => r[idx])).forEach(cat => {
        const o = document.createElement('option');
        o.value = cat;
        o.textContent = cat;
        sel.appendChild(o);
      });
      sel.addEventListener('change', filterTable);
      document.getElementById('search-box').addEventListener('input', filterTable);
    }
    function filterTable() {
      const selVal = document.getElementById('category-filter').value.toLowerCase(),
        q = document.getElementById('search-box').value.toLowerCase();
      const rows = Array.from(
          document.getElementById('comparison-table').tBodies[0].rows
        ),
        headers = Array.from(
          document.querySelectorAll('#comparison-table thead th')
        ).map(th => th.textContent),
        catIdx = headers.indexOf('Category');
      for (let i = 0; i < rows.length; i += 2) {
        const r = rows[i],
          er = rows[i + 1],
          cells = Array.from(r.cells).map(td => td.textContent.toLowerCase()),
          show = (!selVal || cells[catIdx] === selVal) &&
            (!q || cells.some(c => c.includes(q)));
        r.style.display = show ? '' : 'none';
        er.style.display = 'none';
      }
    }
    document.addEventListener('click', e => {
      if (e.target.classList.contains('exp-toggle')) {
        const btn = e.target,
          tr = btn.closest('tr'),
          er = tr.nextElementSibling,
          open = er.style.display === 'table-row';
        er.style.display = open ? 'none' : 'table-row';
        btn.textContent = open ? '▶' : '▼';
      }
    });
    fetchAndRender();
  </script>
</body>
</html>
